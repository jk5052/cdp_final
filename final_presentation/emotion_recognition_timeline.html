<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>감정 데이터 편향 세계지도</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        svg {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .emotion-point {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #f97316;
            pointer-events: none;
            z-index: 1000;
            max-width: 300px;
            font-size: 12px;
            line-height: 1.4;
            display: none;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
        }
        
        select {
            padding: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            font-size: 14px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #f97316;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="projection-select">투영법 선택:</label>
        <select id="projection-select">
            <option value="Natural Earth">Natural Earth</option>
            <option value="Mercator">Mercator</option>
            <option value="Robinson">Robinson</option>
            <option value="Mollweide">Mollweide</option>
            <option value="Orthographic">Orthographic</option>
            <option value="Stereographic">Stereographic</option>
            <option value="Eckert IV">Eckert IV</option>
            <option value="Equal Earth">Equal Earth</option>
            <option value="Hammer">Hammer</option>
            <option value="Winkel tripel">Winkel tripel</option>
        </select>
    </div>

    <div id="map-container">
        <svg id="world-map"></svg>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // 감정 편향 데이터
        const emotionBiasData = [
            {
                region: "북미",
                country: "United States",
                coordinates: [-95, 37],
                biasLevel: 2,
                cases: 180,
                issues: ["서구 중심적 표정 인식", "문화적 맥락 무시", "다양성 부족"],
                description: "주요 AI 기업들이 집중된 지역이지만 오히려 서구 중심적 편향이 가장 심각"
            },
            {
                region: "유럽",
                country: "Germany",
                coordinates: [10, 51],
                biasLevel: 1,
                cases: 95,
                issues: ["개인정보 보호와 감정인식 충돌", "유럽 특화 감정표현"],
                description: "GDPR 등으로 데이터 수집이 제한되어 상대적으로 편향이 적음"
            },
            {
                region: "동아시아",
                country: "China",
                coordinates: [104, 35],
                biasLevel: 3,
                cases: 220,
                issues: ["집체주의 문화 무시", "서구 개인주의 기준 적용", "언어적 맥락 부족"],
                description: "가장 많은 인구를 가진 지역이지만 서구 기준으로 훈련된 AI로 인한 편향 극심"
            },
            {
                region: "동아시아",
                country: "Japan",
                coordinates: [138, 36],
                biasLevel: 2,
                cases: 130,
                issues: ["혼네-타테마에 문화적 맥락", "간접적 감정표현"],
                description: "일본 특유의 감정 표현 방식이 서구 AI 시스템에서 오해받는 사례 다수"
            },
            {
                region: "남아시아",
                country: "India",
                coordinates: [77, 20],
                biasLevel: 3,
                cases: 200,
                issues: ["다언어 감정 표현", "카스트 제도 영향", "종교적 맥락"],
                description: "다양한 언어와 문화가 공존하지만 단일 모델로 처리되어 편향 발생"
            },
            {
                region: "중동",
                country: "Saudi Arabia",
                coordinates: [45, 24],
                biasLevel: 3,
                cases: 160,
                issues: ["종교적 감정 표현 방식", "성별 분리 문화", "아랍 문화적 맥락"],
                description: "이슬람 문화의 감정 표현이 서구 AI에서 부정적으로 해석되는 경우 빈발"
            },
            {
                region: "아프리카",
                country: "Nigeria",
                coordinates: [8, 10],
                biasLevel: 2,
                cases: 85,
                issues: ["부족별 감정 표현 차이", "데이터 부족", "경제적 접근성"],
                description: "아프리카 최대 인구 국가이지만 AI 훈련 데이터에서 현저히 부족"
            },
            {
                region: "남미",
                country: "Brazil",
                coordinates: [-55, -10],
                biasLevel: 2,
                cases: 110,
                issues: ["라틴 문화의 표현적 감정", "포르투갈어 맥락", "사회경제적 다양성"],
                description: "표현적인 라틴 문화의 감정이 AI에서 과장되게 해석되는 편향 존재"
            },
            {
                region: "오세아니아",
                country: "Australia",
                coordinates: [133, -27],
                biasLevel: 0,
                cases: 45,
                issues: ["원주민 문화 고려 부족"],
                description: "서구 문화권이지만 원주민 아보리진 문화는 여전히 AI에서 소외"
            }
        ];

        // 투영법 정의
        const projections = {
            "Natural Earth": d3.geoNaturalEarth1,
            "Mercator": d3.geoMercator,
            "Robinson": d3.geoRobinson,
            "Mollweide": d3.geoMollweide,
            "Orthographic": d3.geoOrthographic,
            "Stereographic": d3.geoStereographic,
            "Eckert IV": d3.geoEckert4,
            "Equal Earth": d3.geoEqualEarth,
            "Hammer": d3.geoHammer,
            "Winkel tripel": d3.geoWinkel3
        };

        // 색상 및 크기 스케일
        const colorScale = d3.scaleOrdinal()
            .domain([0, 1, 2, 3])
            .range(["#38a169", "#d69e2e", "#dd6b20", "#c53030"]);

        const sizeScale = d3.scaleLinear()
            .domain([0, 250])
            .range([8, 35]);

        let currentProjection = 'Natural Earth';
        
        // SVG 선택
        const svg = d3.select("#world-map");
        const tooltip = d3.select("#tooltip");

        function drawMap() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            // 기존 요소들 제거
            svg.selectAll("*").remove();

            // 투영법 설정
            const ProjectionConstructor = projections[currentProjection];
            let projection = ProjectionConstructor()
                .scale(Math.min(width, height) * 0.15)
                .translate([width/2, height/2]);

            // Orthographic 특별 설정
            if (currentProjection === "Orthographic") {
                projection.scale(Math.min(width, height) * 0.2).rotate([0, -30]);
            }

            const path = d3.geoPath().projection(projection);

            // 배경 원 (구체)
            svg.append("circle")
                .attr("cx", width/2)
                .attr("cy", height/2)
                .attr("r", projection.scale())
                .attr("fill", "rgba(255,255,255,0.05)")
                .attr("stroke", "rgba(255,255,255,0.2)")
                .attr("stroke-width", 1);

            // 그리드 라인
            const graticule = d3.geoGraticule();
            svg.append("path")
                .datum(graticule())
                .attr("d", path)
                .attr("fill", "none")
                .attr("stroke", "rgba(255,255,255,0.1)")
                .attr("stroke-width", 0.5);

            // 감정 편향 데이터 포인트
            svg.selectAll(".emotion-point")
                .data(emotionBiasData)
                .enter()
                .append("circle")
                .attr("class", "emotion-point")
                .attr("cx", d => {
                    const coords = projection(d.coordinates);
                    return coords ? coords[0] : 0;
                })
                .attr("cy", d => {
                    const coords = projection(d.coordinates);
                    return coords ? coords[1] : 0;
                })
                .attr("r", d => sizeScale(d.cases))
                .attr("fill", d => colorScale(d.biasLevel))
                .attr("fill-opacity", 0.8)
                .attr("stroke", "white")
                .attr("stroke-width", 1)
                .style("cursor", "pointer")
                .on("mouseover", function(event, d) {
                    // 툴팁 보이기
                    const biasLabels = ["양호", "보통", "심각", "극심"];
                    tooltip.style("display", "block")
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px")
                        .html(`
                            <strong>${d.region} - ${d.country}</strong><br>
                            편향 등급: ${biasLabels[d.biasLevel]}<br>
                            피해 사례: ${d.cases}건<br>
                            주요 이슈: ${d.issues.join(", ")}<br>
                            <br>
                            ${d.description}
                        `);
                    
                    // 원 크기 증가 및 강조
                    d3.select(this)
                        .attr("stroke-width", 3)
                        .attr("r", sizeScale(d.cases) * 1.2);
                })
                .on("mouseout", function(event, d) {
                    // 툴팁 숨기기
                    tooltip.style("display", "none");
                    
                    // 원 크기 원래대로
                    d3.select(this)
                        .attr("stroke-width", 1)
                        .attr("r", sizeScale(d.cases));
                })
                .on("click", function(event, d) {
                    alert(`${d.region} - ${d.country}\n\n상세 정보:\n${d.description}\n\n주요 문제점:\n• ${d.issues.join("\n• ")}`);
                });
        }

        // 투영법 변경 이벤트
        document.getElementById('projection-select').addEventListener('change', function(e) {
            currentProjection = e.target.value;
            drawMap();
        });

        // 초기 지도 그리기
        drawMap();

        // 윈도우 리사이즈 시 지도 다시 그리기
        window.addEventListener('resize', drawMap);
    </script>
</body>
</html>