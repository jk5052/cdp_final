<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Emotion AI Bias Map</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: black;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        svg {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .emotion-point {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #f97316;
            pointer-events: none;
            z-index: 1000;
            max-width: 550px;
            font-size: 13px;
            line-height: 1.4;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tooltip img {
            width: 400px;
            height: 280px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            display: block;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
        }
        
        select {
            padding: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            font-size: 14px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #f97316;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="projection-select">Select Projection:</label>
        <select id="projection-select">
            <option value="Natural Earth">Natural Earth</option>
            <option value="Mercator">Mercator</option>
            <option value="Robinson">Robinson</option>
            <option value="Mollweide">Mollweide</option>
            <option value="Orthographic">Orthographic</option>
            <option value="Stereographic">Stereographic</option>
            <option value="Eckert IV">Eckert IV</option>
            <option value="Equal Earth">Equal Earth</option>
            <option value="Hammer">Hammer</option>
            <option value="Winkel tripel">Winkel tripel</option>
        </select>
    </div>

    <div id="map-container">
        <svg id="world-map"></svg>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Emotional bias data
        const emotionBiasData = [
            {
                region: "North America",
                country: "United States",
                coordinates: [-95, 37],
                biasLevel: 2,
                cases: 180,
                issues: ["Western-centric facial recognition", "Cultural context ignored", "Lack of diversity"],
                description: "Despite being home to major AI companies, Western-centric bias is most severe here"
            },
            {
                region: "North America",
                country: "Canada",
                coordinates: [-106, 56],
                biasLevel: 1,
                cases: 75,
                issues: ["Indigenous culture overlooked", "Bilingual context challenges"],
                description: "Better diversity policies but still struggles with indigenous emotional expressions"
            },
            {
                region: "Europe",
                country: "Germany",
                coordinates: [10, 51],
                biasLevel: 1,
                cases: 95,
                issues: ["GDPR data restrictions", "Cultural expression differences"],
                description: "Relatively less bias due to GDPR regulations but cultural differences still exist"
            },
            {
                region: "East Asia",
                country: "China",
                coordinates: [104, 35],
                biasLevel: 3,
                cases: 220,
                issues: ["Collectivist vs individualist expressions", "Contextual emotional meaning", "Language barriers"],
                description: "Most populous region but extreme bias due to Western-trained AI systems"
            },
            {
                region: "East Asia",
                country: "Japan",
                coordinates: [138, 36],
                biasLevel: 3,
                cases: 165,
                issues: ["Honne-Tatemae cultural context", "Subtle emotional expressions", "Collectivist culture"],
                description: "Japanese unique emotional expression often misunderstood by Western AI systems"
            },
            {
                region: "South Asia",
                country: "India",
                coordinates: [77, 20],
                biasLevel: 3,
                cases: 200,
                issues: ["Multilingual emotional expression", "Caste system influence", "Religious context"],
                description: "Diverse languages and cultures coexist but processed by single model causing bias"
            },
            {
                region: "Middle East",
                country: "Saudi Arabia",
                coordinates: [45, 24],
                biasLevel: 3,
                cases: 160,
                issues: ["Religious emotional expressions", "Gender-separated culture", "Arabic cultural context"],
                description: "Islamic cultural emotional expressions frequently misinterpreted negatively by Western AI"
            },
            {
                region: "Africa",
                country: "Nigeria",
                coordinates: [8, 10],
                biasLevel: 2,
                cases: 85,
                issues: ["Tribal emotional expression differences", "Data scarcity", "Economic accessibility"],
                description: "Africa's most populous country but significantly underrepresented in AI training data"
            },
            {
                region: "South America",
                country: "Brazil",
                coordinates: [-55, -10],
                biasLevel: 2,
                cases: 110,
                issues: ["Expressive Latin culture emotions", "Portuguese context", "Socioeconomic diversity"],
                description: "Expressive Latin cultural emotions often exaggerated in AI interpretation bias"
            },
            {
                region: "Oceania",
                country: "Australia",
                coordinates: [133, -27],
                biasLevel: 0,
                cases: 45,
                issues: ["Indigenous culture consideration lacking"],
                description: "Western culture but Aboriginal indigenous culture still marginalized in AI"
            }
        ];

        // Projection definitions
        const projections = {
            "Natural Earth": d3.geoNaturalEarth1,
            "Mercator": d3.geoMercator,
            "Robinson": d3.geoRobinson,
            "Mollweide": d3.geoMollweide,
            "Orthographic": d3.geoOrthographic,
            "Stereographic": d3.geoStereographic,
            "Eckert IV": d3.geoEckert4,
            "Equal Earth": d3.geoEqualEarth,
            "Hammer": d3.geoHammer,
            "Winkel tripel": d3.geoWinkel3
        };

        // Color and size scales
        const colorScale = d3.scaleOrdinal()
            .domain([0, 1, 2, 3])
            .range(["#38a169", "#d69e2e", "#dd6b20", "#c53030"]);

        // Size scale
        const sizeScale = d3.scaleLinear()
            .domain([0, 250])
            .range([8, 35]);

        let currentProjection = 'Natural Earth';
        
        // SVG 선택
        const svg = d3.select("#world-map");
        const tooltip = d3.select("#tooltip");

        function drawMap() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            // Remove existing elements
            svg.selectAll("*").remove();

            // Projection setup
            const ProjectionConstructor = projections[currentProjection];
            let projection = ProjectionConstructor()
                .scale(Math.min(width, height) * 0.15)
                .translate([width/2, height/2]);

            // Orthographic 특별 설정
            if (currentProjection === "Orthographic") {
                projection.scale(Math.min(width, height) * 0.2).rotate([0, -30]);
            }

            const path = d3.geoPath().projection(projection);

            // 배경 원 (구체)
            svg.append("circle")
                .attr("cx", width/2)
                .attr("cy", height/2)
                .attr("r", projection.scale())
                .attr("fill", "rgba(255,255,255,0.05)")
                .attr("stroke", "rgba(255,255,255,0.2)")
                .attr("stroke-width", 1);

            // 그리드 라인
            const graticule = d3.geoGraticule();
            svg.append("path")
                .datum(graticule())
                .attr("d", path)
                .attr("fill", "none")
                .attr("stroke", "rgba(255,255,255,0.1)")
                .attr("stroke-width", 0.5);

            // 감정 편향 데이터 포인트
            svg.selectAll(".emotion-point")
                .data(emotionBiasData)
                .enter()
                .append("circle")
                .attr("class", "emotion-point")
                .attr("cx", d => {
                    const coords = projection(d.coordinates);
                    return coords ? coords[0] : 0;
                })
                .attr("cy", d => {
                    const coords = projection(d.coordinates);
                    return coords ? coords[1] : 0;
                })
                .attr("r", d => sizeScale(d.cases))
                .attr("fill", d => colorScale(d.biasLevel))
                .attr("fill-opacity", 0.8)
                .attr("stroke", "white")
                .attr("stroke-width", 1)
                .style("cursor", "pointer")
                .on("mouseover", function(event, d) {
                    // Image file mapping
                    let imagePath = "";
                    if (d.country === "United States") imagePath = "America.jpeg";
                    else if (d.country === "Canada") imagePath = "America2.jpeg";
                    else if (d.country === "Germany") imagePath = "europe.jpg";
                    else if (d.country === "China") imagePath = "eastasia.jpg";
                    else if (d.country === "Japan") imagePath = "eastasia2.jpeg";
                    else if (d.country === "India") imagePath = "eastasia2.jpeg";
                    
                    // Tooltip with image (in English)
                    const biasLabels = ["Good", "Moderate", "Severe", "Extreme"];
                    tooltip.style("display", "block")
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px")
                        .html(`
                            <div style="text-align: center; margin-bottom: 10px;">
                                <img src="${imagePath}" style="width: 120px; height: 90px; object-fit: cover; border-radius: 8px; border: 2px solid #f97316;" onerror="this.style.display='none'">
                            </div>
                            <strong>${d.region} - ${d.country}</strong><br>
                            Bias Level: ${biasLabels[d.biasLevel]}<br>
                            Key Issues: ${d.issues.join(", ")}<br>
                            <br>
                            ${d.description}
                        `);
                    
                    // Increase circle size and highlight
                    d3.select(this)
                        .attr("stroke-width", 3)
                        .attr("r", sizeScale(d.cases) * 1.2);
                })
                .on("mouseout", function(event, d) {
                    // Hide tooltip
                    tooltip.style("display", "none");
                    
                    // Restore original circle size
                    d3.select(this)
                        .attr("stroke-width", 1)
                        .attr("r", sizeScale(d.cases));
                })
                .on("click", function(event, d) {
                    alert(`${d.region} - ${d.country}\n\nDetails:\n${d.description}\n\nKey Issues:\n• ${d.issues.join("\n• ")}`);
                });
        }

        // Projection change event
        document.getElementById('projection-select').addEventListener('change', function(e) {
            currentProjection = e.target.value;
            drawMap();
        });

        // 초기 지도 그리기
        drawMap();

        // 윈도우 리사이즈 시 지도 다시 그리기
        window.addEventListener('resize', drawMap);
    </script>
</body>
</html>